<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Snake</title>
  <style>
    body { margin: 0; height: 100vh; display: grid; place-items: center; font-family: system-ui; background: #111; }
    #wrap { position: relative; }
    canvas { border: 2px solid #222; background: #556B2F; }

    .overlay {
      position: absolute; inset: 0;
      display: none;
      align-items: center; justify-content: center;
      background: rgba(0,0,0,.55);
      color: #fff;
    }
    .panel {
      background: rgba(20,20,20,.9);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 18px;
      min-width: 280px;
      box-shadow: 0 10px 30px rgba(0,0,0,.4);
    }
    .title { font-size: 28px; font-weight: 800; margin: 0 0 10px; }
    .row { margin: 12px 0; }
    button {
      width: 100%;
      padding: 10px 12px;
      border: 0; border-radius: 10px;
      background: #2f6f2f; color: white;
      font-size: 16px; font-weight: 700;
      cursor: pointer;
    }
    button.secondary { background: #444; }
    label { display: block; font-weight: 700; margin-bottom: 6px; }
    input[type="range"], select { width: 100%; }
    .small { opacity: .9; font-size: 13px; }
    #hud {
      margin-top: 10px;
      color: #eee;
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      width: 404px;
    }
  </style>
</head>
<body>
<div id="wrap">
  <canvas id="c" width="400" height="400"></canvas>

  <div id="menu" class="overlay" style="display:flex;">
    <div class="panel">
      <div class="title">SNAKE</div>
      <button id="playBtn">Play</button>
    </div>
  </div>
</div>

<div id="hud">
  <div>Score: <span id="score">0</span></div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const menuOverlay = document.getElementById("menu");
const playBtn = document.getElementById("playBtn");
const scoreEl = document.getElementById("score");

const SIZE = 20;
const COLS = canvas.width / SIZE;
const ROWS = canvas.height / SIZE;

let snake = null;
let foods = null;
let dir, pendingDir;
let score = 0;
let stepMs = 120;
let timer = null;

let prevSnake = null;
let animStart = 0;
let animT = 1;

function lerp(a,b,t){ return a+(b-a)*t; }

function drawBackground() {
  ctx.fillStyle = "#556B2F";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle = "#8b2e2e";
  ctx.lineWidth = 6;
  ctx.strokeRect(0,0,canvas.width,canvas.height);
}

/* ðŸ”’ FIX: SAFE DRAW GUARD */
function draw() {
  drawBackground();
  if (!snake || !foods) return;

  ctx.fillStyle = "#f2d7a0";
  for (let f of foods) {
    ctx.fillRect(f.x*SIZE, f.y*SIZE, SIZE, SIZE);
  }

  ctx.fillStyle = "#0b3d0b";
  for (let i=0;i<snake.length;i++) {
    let x = snake[i].x;
    let y = snake[i].y;
    if (prevSnake && prevSnake[i]) {
      x = lerp(prevSnake[i].x, snake[i].x, animT);
      y = lerp(prevSnake[i].y, snake[i].y, animT);
    }
    ctx.fillRect(x*SIZE, y*SIZE, SIZE, SIZE);
  }
}

function spawnFood() {
  while (true) {
    const f = {x:(Math.random()*COLS)|0, y:(Math.random()*ROWS)|0};
    if (!snake.some(s=>s.x===f.x && s.y===f.y)) return f;
  }
}

function resetGame() {
  snake = [{x:10,y:10}];
  foods = [spawnFood()];
  dir = {x:1,y:0};
  pendingDir = dir;
  score = 0;
  scoreEl.textContent = score;
  prevSnake = snake.slice();
  animStart = performance.now();
}

function tick() {
  prevSnake = snake.slice();
  animStart = performance.now();
  animT = 0;

  dir = pendingDir;
  const head = snake[0];
  const next = {x:head.x+dir.x, y:head.y+dir.y};

  if (next.x<0||next.x>=COLS||next.y<0||next.y>=ROWS) {
    clearInterval(timer);
    menuOverlay.style.display="flex";
    snake=null; foods=null;
    return;
  }

  snake.unshift(next);

  if (foods.some(f=>f.x===next.x&&f.y===next.y)) {
    score++;
    scoreEl.textContent=score;
    foods=[spawnFood()];
  } else {
    snake.pop();
  }
}

function animate(now) {
  if (snake) {
    animT=(now-animStart)/stepMs;
    if(animT>1)animT=1;
  }
  draw();
  requestAnimationFrame(animate);
}

playBtn.onclick=()=>{
  menuOverlay.style.display="none";
  resetGame();
  clearInterval(timer);
  timer=setInterval(tick,stepMs);
};

document.addEventListener("keydown",e=>{
  if(!snake)return;
  if(e.key==="ArrowUp"&&dir.y!==1)pendingDir={x:0,y:-1};
  if(e.key==="ArrowDown"&&dir.y!==-1)pendingDir={x:0,y:1};
  if(e.key==="ArrowLeft"&&dir.x!==1)pendingDir={x:-1,y:0};
  if(e.key==="ArrowRight"&&dir.x!==-1)pendingDir={x:1,y:0};
});

draw();
requestAnimationFrame(animate);
</script>
</body>
</html>
